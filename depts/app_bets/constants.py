"""
Константы для приложения анализа ставок.

Разделы:
1. Исходы матчей (Outcome)
2. Анализ матчей
3. Парсинг данных
4. Сообщения и тексты
"""

from decimal import Decimal


class Outcome:
    """
    Исходы матчей для анализа паттернов.
    Используется в анализе форм команд.
    """
    WIN = 'В'  # Победа
    LOSE = 'П'  # Поражение
    DRAW = 'Н'  # Ничья


class AnalysisConstants:
    """
    Константы для анализа футбольных матчей.
    """

    # ==================== ДОПУСКИ ДЛЯ "БЛИЗНЕЦОВ" ====================
    TWINS_TOLERANCE_SMALL = Decimal('0.05')  # 5% - малый допуск
    TWINS_TOLERANCE_LARGE = Decimal('0.10')  # 10% - расширенный допуск

    # ==================== ПАРАМЕТРЫ ПАТТЕРНОВ ====================
    PATTERN_FORM_LENGTH = 4  # Длина паттерна формы (последние 4 матча)

    # ==================== ПАРАМЕТРЫ ПУАССОНА ====================
    POISSON_MAX_GOALS = 8  # Максимальное количество голов для расчета
    POISSON_MIN_LAMBDA = 0.01  # Минимальное значение лямбды

    # ==================== МИНИМАЛЬНЫЕ ЗНАЧЕНИЯ ====================
    MIN_PROBABILITY = 0.01  # Минимальная вероятность для учета (%)
    MIN_TEAM_NAME_LENGTH = 2  # Минимальная длина названия команды

    HISTORICAL_YEARS = 20  # Глубина исторического анализа в годах
    HISTORICAL_MIN_MATCHES = 50  # Минимальное количество матчей для выборки
    HISTORICAL_MAX_SAMPLE = 2000  # Максимальный размер выборки для производительности
    HISTORICAL_SIMILARITY_THRESHOLD = 20  # Минимальный порог похожести
    HISTORICAL_WEIGHT_CAP = 5.0  # Максимальный вес для байесовской коррекции
    TOTAL_THRESHOLD = 2.5  # Порог для тотала больше/меньше
    TOTAL_OVER = 'БОЛЬШЕ'
    TOTAL_UNDER = 'МЕНЬШЕ'

    # Уровни уверенности
    CONFIDENCE_HIGH = 'ВЫСОКАЯ'
    CONFIDENCE_MEDIUM = 'СРЕДНЯЯ'
    CONFIDENCE_LOW = 'НИЗКАЯ'
    CONFIDENCE_RANDOM = 'СЛУЧАЙНАЯ'

    # Прогнозы
    PREDICTION_OVER = 'БОЛЬШЕ'
    PREDICTION_UNDER = 'МЕНЬШЕ'
    PREDICTION_FIFTY = '50/50'

    LAMBDA_LAST_N = 10


class ParsingConstants:
    """
    Константы для парсинга текстовых данных.
    """

    # ==================== РЕГУЛЯРНЫЕ ВЫРАЖЕНИЯ ====================
    ODDS_REGEX = r'^\d+[\.,]\d+$'  # Коэффициенты (1.23 или 1,23)
    TIME_REGEX = r'^\d{1,2}[:\.]\d{2}$'  # Время (20:30 или 20.30)
    DIGITS_ONLY_REGEX = r'^\d+$'  # Только цифры

    # ==================== ПАРАМЕТРЫ ПОИСКА ====================
    MAX_SEARCH_DEPTH = 10  # Максимальное количество строк для поиска команд
    MAX_LINES_PER_MATCH = 20  # Максимальное количество строк на матч

    # ==================== КЛЮЧЕВЫЕ СЛОВА ДЛЯ ПРОПУСКА ====================
    SKIP_KEYWORDS = {
        '-', 'vs', 'v', 'против', 'against',
        '1', 'x', '2', '1x2', '1 x 2', '1 x 2'
    }

    # ==================== НАЗВАНИЯ ЛИГ И СТРАН ====================
    LEAGUE_KEYWORDS = {
        'чемпионшип', 'бундеслига', 'примера', 'ла лига', 'премьер лига',
        'англия', 'германия', 'испания', 'италия', 'франция', 'россия',
        'лига 1', 'лига 2', 'серия а', 'серия б', 'вторая', 'первая'
    }

    # ==================== ЧЕРНЫЙ СПИСОК КОРОТКИХ СТРОК ====================
    BLACKLIST = {'1', '2', 'x', 'xi', 'x1', 'x2', 'i', 'ii', 'iii', 'iv', 'v', 'vi'}

    DIV_TO_LEAGUE_NAME = {
        'E0': 'АПЛ Англия',
        'E1': 'Чемпионшип Англия',
        'D1': 'Бундеслига Германия',
        'D2': 'Бундеслига 2 Германия',
        'SP1': 'Ла Лига Испания',
        'SP2': 'Сегунда Испания',
        'I1': 'Серия А Италия',
        'I2': 'Серия Б Италия',
        'F1': 'Лига 1 Франция',
        'F2': 'Лига 2 Франция',
        'N1': 'Эредивизи Нидерланды',
        'P1': 'Высшая лига Португалия',
        'T1': 'Суперлига Турция',
        'B1': 'Высшая лига Бельгия',
        'SC0': 'Премьер Лига Шотландия',
    }


class Messages:
    """
    Текстовые сообщения и подсказки для интерфейса.
    """

    # ==================== СООБЩЕНИЯ ОБ ОШИБКАХ ====================
    NO_DATA_MESSAGE = "Не удалось распознать данные матчей."
    TEAM_NOT_FOUND = "Команда не найдена в базе данных."
    INSUFFICIENT_DATA = "Недостаточно данных для анализа."

    # ==================== СТАТУСЫ АНАЛИЗА ====================
    PATTERN_INSUFFICIENT_DATA = "Недостаточно данных"
    PATTERN_NOT_FOUND = "Паттерн не найден в истории"
    TWINS_NO_DATA = "Нет данных"
    H2H_NO_MATCHES = "Игр в таком статусе не найдено"

    # ==================== ФОРМАТЫ ВЫВОДА ====================
    DATE_FORMAT = '%d.%m.%y'  # Формат даты: 25.12.23
    DECIMAL_FORMAT = '0.00'  # Формат десятичных чисел: 1.50
    PERCENTAGE_FORMAT = '{:.1f}%'  # Формат процентов: 45.5%

    # ==================== ЛОГИРОВАНИЕ ====================
    ALIAS_CREATED = "Создан/обновлен алиас: {} → team_id={}"
    MATCH_FOUND = "Найден матч: {} - {} ({}/{}/{})"
    TOTAL_MATCHES = "Всего найдено матчей: {}"


# ============================================================================
# ЕДИНЫЙ ФАЙЛ КОНСТАНТ ДЛЯ ВСЕГО ПРИЛОЖЕНИЯ
# ============================================================================

# ========== БЛОКИ ВЕРОЯТНОСТИ ==========
PROBABILITY_BINS = [
    (0, 10), (10, 20), (20, 30), (30, 40), (40, 50),
    (50, 60), (60, 70), (70, 80), (80, 90), (90, 100)
]

# ========== БЛОКИ ДЛЯ П1 (полная сетка) ==========
P1_ODDS_BINS = [
    (1.00, 1.30), (1.31, 1.6), (1.61, 1.9), (1.91, 2.3), (2.31, 2.7),
    (2.71, 3.2), (3.21, 3.8), (3.81, 4.5), (4.51, 5.5), (5.51, 6.7),
    (6.71, 7.8), (7.81, 9.1), (9.11, float('inf'))
]

# ========== БЛОКИ ДЛЯ ТБ (только 4 блока) ==========
TB_ODDS_BINS = [
    (1.00, 1.30),    # меньше 1.30
    (1.30, 1.61),    # 1.30 - 1.60
    (1.61, 1.96),    # 1.61 - 1.95
    (1.96, float('inf'))  # больше 1.95
]

# ========== ВЕСА ДЛЯ ВОЗРАСТНЫХ ГРУПП ==========
YEAR_WEIGHTS = {
    '0-5': 1.0,    # последние 5 лет - полный вес
    '6-10': 0.7,   # 6-10 лет назад - 70%
    '11-15': 0.4,  # 11-15 лет назад - 40%
    '16+': 0.2     # 16+ лет назад - 20%
}

# ========== ПАРАМЕТРЫ АНАЛИЗА ==========
MIN_TOTAL = 3
MIN_EV = 7
ALPHA = 1
BETA = 1
BAYES_THRESHOLD = 100

# ========== ГРУППИРОВКА ЛИГ ПО РЕЗУЛЬТАТИВНОСТИ ==========
LEAGUES_WITH_SCORING = [
    ('Бундеслига Германия', 3.18),
    ('Эредивизи Нидерланды', 3.12),
    ('Бундеслига 2 Германия', 3.0),
    ('АПЛ Англия', 2.97),
    ('Суперлига Турция', 2.87),
    ('Премьер Лига Шотландия', 2.85),
    ('Лига 1 Франция', 2.83),
    ('Высшая лига Бельгия', 2.82),
    ('Высшая лига Португалия', 2.67),
    ('Ла Лига Испания', 2.6),
    ('Серия А Италия', 2.55),
    ('Чемпионшип Англия', 2.53),
    ('Лига 2 Франция', 2.48),
    ('Серия Б Италия', 2.45),
    ('Сегунда Испания', 2.31),
]

# ========== ПОПРАВКИ ПО ЛИГАМ ==========
LEAGUE_BIAS_CORRECTION = {
    'АПЛ Англия': 3.0,
    'Бундеслига Германия': 4.0,
    'Бундеслига 2 Германия': 3.0,
    'Высшая лига Бельгия': 2.0,
    'Высшая лига Португалия': 4.0,
    'Ла Лига Испания': 2.0,
    'Лига 1 Франция': 4.0,
    'Лига 2 Франция': 4.0,
    'Премьер Лига Шотландия': 3.0,
    'Сегунда Испания': 3.0,
    'Серия А Италия': 1.0,
    'Серия Б Италия': 3.0,
    'Суперлига Турция': 5.0,
    'Чемпионшип Англия': 3.0,
    'Эредивизи Нидерланды': 4.0,
}

# ========== ПАРАМЕТРЫ ТРЕНДОВОЙ КОРРЕКЦИИ ==========
TREND_WINDOW = 12
TREND_STRENGTH = 0.15
BASE_TREND_ADJUSTMENT = 4.0