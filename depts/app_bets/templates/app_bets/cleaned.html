{% extends 'base.html' %}
{% load static %}

{% block content %}
<link rel="stylesheet" href="{% static 'app_bets/css/styles.css' %}">

<div class="ds-header-block">
    <h1><i class="fa-solid fa-chart-line"></i> Анализ матчей по калибровке</h1>
</div>

<!-- Кнопка экспорта (стили как на главной) -->
<div class="bets-sort-container" style="justify-content: flex-end;">
    <div class="bets-actions-wrapper">
        {% if analysis_results %}
        <a href="{% url 'app_bets:export_cleaned' %}" class="bets-export-btn">
            <i class="fa-solid fa-file-excel"></i> В Excel
        </a>
        {% endif %}
    </div>
</div>

<div class="bets-results-container-full">
    {% if error %}
        <div class="alert alert-danger">{{ error }}</div>
    {% elif analysis_results %}
        {% for res in analysis_results %}
        <div class="bets-result-card">
            <div class="match-header-line">
                <div class="match-title-line">
                    <div style="display: flex; align-items: baseline; gap: 10px;">
                        <span class="match-time">{{ res.time }}</span>
                        <strong class="match-name-large">{{ res.match }}</strong>
                    </div>
                    <div class="league-line">{{ res.league }}</div>
                </div>
                <div class="odds-line">
                    <div class="odd-box-line">
                        <div class="odd-label-line">ТБ 2.5</div>
                        <div class="odd-value-line">{{ res.odds_over|floatformat:2 }}</div>
                    </div>
                    <div class="odd-sep-line">|</div>
                    <div class="odd-box-line">
                        <div class="odd-label-line">ТМ 2.5</div>
                        <div class="odd-value-line">{{ res.odds_under|floatformat:2 }}</div>
                    </div>
                </div>
                <div class="verdict-line verdict-p1" style="background:#d4edda; color:#155724; border-color:#b1dfbb;">
                    {{ res.target }} (EV +{{ res.ev }}%)
                </div>
            </div>

            <div class="match-details-row">
                <span><strong>Прогноз Пуассона:</strong> {{ res.poisson_prob }}%</span>
                <span><strong>Фактическая вероятность:</strong> {{ res.actual_prob }}% (интервал {{ res.interval }})</span>
                <span><strong>n =</strong> {{ res.n }}</span>
            </div>
        </div>
        {% endfor %}
    {% else %}
        <div class="no-results">
            <i class="fa-solid fa-futbol no-results-icon"></i>
            <p class="no-results-text">Нет матчей с положительным EV</p>
        </div>
    {% endif %}
</div>

<style>
.match-time {
    font-size: 1rem;
    color: #6c757d;
    background: #e9ecef;
    padding: 2px 8px;
    border-radius: 12px;
    font-weight: 500;
}
.match-details-row {
    display: flex;
    gap: 30px;
    margin-top: 10px;
    padding-top: 8px;
    border-top: 1px dashed #dee2e6;
    font-size: 0.95rem;
    flex-wrap: wrap;
}
@media (max-width: 768px) {
    .match-details-row {
        flex-direction: column;
        gap: 5px;
    }
}
</style>
{% endblock %}