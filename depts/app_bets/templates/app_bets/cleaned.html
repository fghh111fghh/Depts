{% extends 'app_bets/base.html' %}
{% load static %}

{% block content %}
<link rel="stylesheet" href="{% static 'app_bets/css/pages/cleaned.css' %}">

<div class="cl-header">
    <p class="cl-header-description">Найдено матчей с положительным математическим ожиданием: {{ total_analyzed }}</p>
</div>

<!-- Панель сортировки и экспорта -->
<div class="cl-controls">
    <div class="cl-sort-panel">
        <span class="cl-sort-label">Сортировка:</span>
        <a href="?sort=time_asc" class="cl-sort-btn {% if current_sort == 'time_asc' %}active{% endif %}">
            <i class="fa-solid fa-clock"></i> Время ↑
        </a>
        <a href="?sort=time_desc" class="cl-sort-btn {% if current_sort == 'time_desc' %}active{% endif %}">
            <i class="fa-solid fa-clock"></i> Время ↓
        </a>
        <a href="?sort=league_asc" class="cl-sort-btn {% if current_sort == 'league_asc' %}active{% endif %}">
            <i class="fa-solid fa-trophy"></i> Лига А-Я
        </a>
        <a href="?sort=league_desc" class="cl-sort-btn {% if current_sort == 'league_desc' %}active{% endif %}">
            <i class="fa-solid fa-trophy"></i> Лига Я-А
        </a>
        <a href="?sort=ev_desc" class="cl-sort-btn {% if current_sort == 'ev_desc' or not current_sort %}active{% endif %}">
            <i class="fa-solid fa-chart-line"></i> EV ↓
        </a>
        <a href="?sort=ev_asc" class="cl-sort-btn {% if current_sort == 'ev_asc' %}active{% endif %}">
            <i class="fa-solid fa-chart-line"></i> EV ↑
        </a>
    </div>

    <div class="cl-export-panel">
        {% if analysis_results %}
        <a href="{% url 'app_bets:export_cleaned' %}" class="cl-export-btn">
            <i class="fa-solid fa-file-excel"></i> Экспорт
        </a>
        {% endif %}
    </div>
</div>

<div class="cl-results-container">
    {% if error %}
        <div class="cl-alert cl-alert-danger">{{ error }}</div>
    {% elif analysis_results %}
        {% for res in analysis_results %}
        <div class="cl-match-card">
            <!-- Основной контент (левая часть + правый блок) -->
            <div class="cl-content-wrapper">
                <!-- Левая часть с информацией -->
                <div class="cl-left-content">
                    <!-- Первая строка: время, матч, заголовки -->
                    <div class="cl-row-top">
                        <div class="cl-match-info">
                            <span class="cl-match-time">{{ res.time }}</span>
                            <span class="cl-match-name">{{ res.match }}</span>
                        </div>
                        <div class="cl-odds-headers">
                            <span class="cl-odds-header">ТБ 2.5</span>
                            <span class="cl-odds-sep">|</span>
                            <span class="cl-odds-header">ТМ 2.5</span>
                        </div>
                    </div>

                    <!-- Вторая строка: лига и коэффициенты -->
                    <div class="cl-row-middle">
                        <div class="cl-league">{{ res.league }}</div>
                        <div class="cl-odds-values">
                            <span class="cl-odds-value">{{ res.odds_over|floatformat:2 }}</span>
                            <span class="cl-odds-sep">|</span>
                            <span class="cl-odds-value">{{ res.odds_under|floatformat:2 }}</span>
                        </div>
                    </div>
                </div>

                <!-- Правый цветной блок на две строки -->
                <div class="cl-right-block {% if 'ТБ' in res.target %}cl-right-green{% else %}cl-right-red{% endif %}">
                    <span class="cl-right-target">{{ res.target }}</span>
                    <span class="cl-right-sep">|</span>
                    <span class="cl-right-ev">EV +{{ res.ev }}%</span>
                </div>
            </div>

            <!-- Третья строка: кнопка (прижата вправо) -->
            <div class="cl-row-bottom">
                <a href="..." class="cl-account-btn">
                    <i class="fa-solid fa-book"></i> Учесть ставку
                </a>
            </div>
        </div>
        {% endfor %}
    {% else %}
        <div class="cl-no-results">
            <i class="fa-solid fa-futbol cl-no-results-icon"></i>
            <p class="cl-no-results-text">Нет матчей с EV > {{ min_ev }}%</p>
            <p class="cl-no-results-subtext">Попробуйте изменить критерии отбора или добавить больше матчей</p>
        </div>
    {% endif %}
</div>
{% endblock %}