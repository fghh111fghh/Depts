{% extends 'app_bets/base.html' %}
{% load static %}

{% block content %}
<link rel="stylesheet" href="{% static 'app_bets/css/pages/develop.css' %}">

<div class="develop-container">
    <div class="develop-header">
        <h1><i class="fa-solid fa-calculator"></i> Калькулятор ставок по Келли</h1>
        <p class="develop-description">Расчет оптимального размера ставки на основе критерия Келли</p>
    </div>

    <div class="calculator-card">
        <form id="kellyForm" class="calculator-form">
            {% csrf_token %}

            <div class="form-group">
                <label for="odds">
                    <i class="fa-solid fa-chart-line"></i> Коэффициент
                </label>
                <input type="number" id="odds" name="odds" class="form-control"
                       step="0.01" min="1.01" placeholder="2.00" required
                       oninput="updateDefaultProbability()">
                <small class="form-text">Коэффициент на выбранный исход (≥ 1.01)</small>
            </div>

            <div class="form-group">
                <label for="probability">
                    <i class="fa-solid fa-percent"></i> Вероятность, %
                </label>
                <input type="number" id="probability" name="probability" class="form-control"
                       step="0.1" min="0.1" max="99.9" placeholder="52.5" required>
                <small class="form-text">
                    Ваша оценка вероятности.
                    <span id="defaultProbHint" class="probability-hint"></span>
                </small>
                <div class="probability-actions">
                    <button type="button" id="useDefaultProb" class="btn-small">
                        <i class="fa-solid fa-rotate-left"></i> Сбросить к расчетному
                    </button>
                </div>
            </div>

            <div class="form-group">
                <label for="bank">
                    <i class="fa-solid fa-coins"></i> Банк, ₽
                </label>
                <input type="number" id="bank" name="bank" class="form-control"
                       min="100" step="1" placeholder="100000" required>
                <small class="form-text">Текущий размер банка в рублях</small>
            </div>

            <div class="form-group">
                <label for="kelly_fraction">
                    <i class="fa-solid fa-scale-balanced"></i> Доля Келли
                </label>
                <select id="kelly_fraction" name="kelly_fraction" class="form-control">
                    <option value="0.1">0.1 (консервативно)</option>
                    <option value="0.2" selected>0.2 (рекомендуется)</option>
                    <option value="0.3">0.3</option>
                    <option value="0.4">0.4</option>
                    <option value="0.5">0.5 (умеренно)</option>
                    <option value="0.6">0.6</option>
                    <option value="0.7">0.7</option>
                    <option value="0.8">0.8</option>
                    <option value="0.9">0.9</option>
                    <option value="1.0">1.0 (полный Келли)</option>
                </select>
                <small class="form-text">Доля от полного Келли (рекомендуется 0.2-0.5)</small>
            </div>

            <button type="button" id="calculateBtn" class="calculate-btn">
                <i class="fa-solid fa-calculator"></i> Рассчитать ставку
            </button>
        </form>

        <!-- Блок результатов -->
        <div id="resultBlock" class="result-section" style="display: none;">
            <h3 class="result-title">Результаты расчета</h3>

            <div class="result-grid">
                <div class="result-item">
                    <span class="result-label">Вероятность:</span>
                    <span class="result-value" id="resultProb">0%</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Коэффициент:</span>
                    <span class="result-value" id="resultOdds">0</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Банк:</span>
                    <span class="result-value" id="resultBank">0 ₽</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Доля Келли:</span>
                    <span class="result-value" id="resultKelly">0</span>
                </div>
            </div>

            <div class="result-cards">
                <div class="result-card success">
                    <div class="card-label">РЕКОМЕНДУЕМАЯ СТАВКА</div>
                    <div class="card-value" id="recommendedStake">0 ₽</div>
                </div>

                <div class="result-card info">
                    <div class="card-label">% ОТ БАНКА</div>
                    <div class="card-value" id="stakePercent">0.00%</div>
                </div>
            </div>

            <div class="progress-section">
                <div class="progress-header">
                    <span>Доля банка</span>
                    <span id="progressPercent">0%</span>
                </div>
                <div class="progress-track">
                    <div class="progress-fill" id="progressFill" style="width: 0%;"></div>
                </div>
            </div>

            <div class="formula-info">
                <i class="fa-solid fa-square-root-variable"></i>
                <span>Критерий Келли: f = (p × k - 1) / (k - 1), где p — вероятность в долях</span>
            </div>
        </div>

        <!-- Сообщение об ошибке -->
        <div id="errorBlock" class="error-section" style="display: none;">
            <i class="fa-solid fa-circle-exclamation"></i>
            <span id="errorMessage"></span>
        </div>
    </div>
</div>

<script src="{% static 'app_bets/js/develop.js' %}"></script>
{% endblock %}